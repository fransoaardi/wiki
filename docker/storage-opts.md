# intro
when building docker image, ran into error message like below
```
no space left on device
```

# why
- when building docker image, docker image may be larger than the default 10G 

- `nothing is set on docker-storage file.`
```
$ cat /etc/sysconfig/docker-storage
# This file may be automatically generated by an installation program.

# By default, Docker uses a loopback-mounted sparse file in
# /var/lib/docker.  The loopback makes it slower, and there are some
# restrictive defaults, such as 100GB max storage.

# If your installation did not set a custom storage for Docker, you
# may do it below.

# Example: Use a custom pair of raw logical volumes (one for metadata,
# one for data).
# DOCKER_STORAGE_OPTIONS="--storage-opt dm.metadatadev=/dev/myvg/my-docker-metadata --storage-opt dm.datadev=/dev/myvg/my-docker-data"

DOCKER_STORAGE_OPTIONS=
```
# howto

```
# stop docker
$ sudo systemctl stop docker

# remove /var/lib/docker because prior filesystem may crash with additional setting
$ sudo rm -rf /var/lib/docker

# change basesize from 10G to 50G
$ sudo dockerd --storage-opt dm.basesize=50G

# re-run docker
$ sudo systemctl start docker
```

# references
- https://docs.docker.com/engine/reference/commandline/dockerd/

```
dm.basesize
Specifies the size to use when creating the base device, which limits the size of images and containers. The default value is 10G. Note, thin devices are inherently “sparse”, so a 10G device which is mostly empty doesn’t use 10 GB of space on the pool. However, the filesystem will use more space for the empty case the larger the device is.

The base device size can be increased at daemon restart which will allow all future images and containers (based on those new images) to be of the new base device size.

Examples
$ sudo dockerd --storage-opt dm.basesize=50G
This will increase the base device size to 50G. The Docker daemon will throw an error if existing base device size is larger than 50G. A user can use this option to expand the base device size however shrinking is not permitted.

This value affects the system-wide “base” empty filesystem that may already be initialized and inherited by pulled images. Typically, a change to this value requires additional steps to take effect:

$ sudo service docker stop

$ sudo rm -rf /var/lib/docker

$ sudo service docker start
```
